<!DOCTYPE html>
<html>

<head>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>

<body>

  <script type="module">
    import { computeGameState } from './bundle.js';

    function preload() {
      this.load.setBaseURL('.');
      this.load.image('sky', 'assets/space3.png');
      this.load.image('logo', 'assets/phaser3-logo.png');
      this.load.image('red', 'assets/red.png');
      this.load.image('up', 'assets/up.png');
      this.load.image('down', 'assets/down.png');
      this.load.image('left', 'assets/left.png');
      this.load.image('right', 'assets/right.png');
    }

    function create() {
      this.add.image(400, 300, 'sky');

      const particles = this.add.particles('red');
      const emitter = particles.createEmitter({
        speed: 100,
        scale: { start: 1, end: 0 },
        blendMode: 'ADD'
      });
      
      this.logo = this.physics.add.image(400, 100, 'logo');
      emitter.startFollow(this.logo);

      const style = { font: '20px Arial', fill: '#fff' };
      this.t0 = new Date().getTime();
      this.timeText = this.add.text(20, 20, 'time: ', style);

      this.arrow = this.input.keyboard.createCursorKeys();
    }

    function update() {
      const time = new Date().getTime() - this.t0
      this.timeText.setText('time: ' + time);
      const pressedKeys = {
        right: this.arrow.right.isDown,
        left: this.arrow.left.isDown,
        up: this.arrow.up.isDown,
        down: this.arrow.down.isDown,
      }
      const { incrX, incrY } = computeGameState(pressedKeys)
      this.logo.x += incrX
      this.logo.y += incrY
    }

    // refs:
    // - https://phaser.io/tutorials/getting-started-phaser3/part5
    // - https://phaser.io/tutorials/making-your-first-phaser-3-game/part7
    // - https://www.lesscake.com/phaser-game-tutorial

    const game = new Phaser.Game({
      type: Phaser.AUTO,
      width: 800,
      height: 600,
      physics: {
        default: 'arcade',
      },
      scene: {
        preload: preload,
        create: create,
        update: update
      }
    });
  </script>

</body>

</html>